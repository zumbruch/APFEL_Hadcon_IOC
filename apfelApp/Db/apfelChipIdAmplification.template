#! Generated by VisualDCT v2.6
#! DBDSTART
#! DBD("/home/epics/playground/PANDA/apfelDatabase/dbd/apfel.dbd")
#! DBDEND
#
# PREFIX        = $(PREFIX)
# NAME          = $(NAME)
# SUFFIX        = $(SUFFIX)
# chipId        = $(chipId)
# pinSet        = $(pinSet)
# sideSelection = $(sideSelection)
# port          = $(port)
# channel       = $(channel)
# dacMonitorChannel            = $(dacMonitorChannel)
# dacLowAmplificationLimitLow  = $(dacLowAmplificationLimitLow)
# dacLowAmplificationLimitHigh = $(dacLowAmplificationLimitHigh)
# dacHighAmplificationLimitLow = $(dacHighAmplificationLimitLow)
# dacHighAmplificationLimitHigh= $(dacHighAmplificationLimitHigh)


record(bo, "$(H)ch$(channel):amplification$(SUFFIX)") {
  field(FLNK, "$(H)ch$(channel):amplification:select$(S)_")
  field(ZNAM, "High")
  field(ONAM, "Low")
  field(UDF, "0")
}

record(longout, "$(H)ch$(channel):amplification:reset$(S)_") {
  field(DTYP, "stream")
  field(OUT, "@$(protocolFile) resetAmplification($(chipId),$(pinSet),$(sideSelection),$(port)) $(device)")
  field(DOL, "$(channel)")
  field(OMSL, "closed_loop")
  field(FLNK, "$(H)ch$(channel):amplification:check$(SUFFIX)_ PP MS")
}

record(longout, "$(H)ch$(channel):amplification:set$(S)_") {
  field(DTYP, "stream")
  field(OUT, "@$(protocolFile) setAmplification($(chipId),$(pinSet),$(sideSelection),$(port)) $(device)")
  field(DOL, "$(channel)")
  field(OMSL, "closed_loop")
  field(FLNK, "$(H)ch$(channel):amplification:check$(SUFFIX)_ PP MS")
}

record(calcout, "$(H)ch$(channel):amplification:check$(S)_") {
  field(CALC, "(F&&(A<D||A>E))||(!F&&(A<B||A>C))")
  field(INPA, "$(H)dac$(dacMonitorChannel)$(SUFFIX)")
  field(INPB, "$(dacLowAmplificationLimitLow)")
  field(INPC, "$(dacLowAmplificationLimitHigh)")
  field(INPD, "$(dacHighAmplificationLimitLow)")
  field(INPE, "$(dacHighAmplificationLimitHigh)")
  field(INPF, "$(H)ch$(channel):amplification$(SUFFIX).VAL")
  field(OUT, "$(H)ch$(channel):amplification$(SUFFIX) CA MS")
  field(DOPT, "Use OCAL")
  field(HIGH, "1")
  field(HSV, "MINOR")
  field(OCAL, "F")
  field(SCAN, "10 second")
  field(OOPT, "On Change")
}

record(longout, "$(H)ch$(channel):amplification:select$(S)_") {
  field(OUT, "$(H)ch$(channel):amplification:reset$(SUFFIX)_.PROC CA")
  field(SIML, "$(H)ch$(channel):amplification$(SUFFIX).VAL")
  field(VAL, "1")
  field(DOL, "1")
  field(OMSL, "closed_loop")
  field(SIOL, "$(H)ch$(channel):amplification:set$(SUFFIX)_.PROC CA")
  field(SIMS, "NO_ALARM")
}

#! Further lines contain data used by VisualDCT
#! View(2479,2878,1.2)
#! Record("$(H)ch$(channel):amplification$(SUFFIX)",2160,2625,0,1,"$(H)ch$(channel):amplification$(SUFFIX)")
#! Field("$(H)ch$(channel):amplification$(SUFFIX).FLNK",13369395,1,"$(H)ch$(channel):amplification$(SUFFIX).FLNK")
#! Link("$(H)ch$(channel):amplification$(SUFFIX).FLNK","$(H)ch$(channel):amplification:select$(S)_")
#! Field("$(H)ch$(channel):amplification$(SUFFIX).VAL",16777215,1,"$(H)ch$(channel):amplification$(SUFFIX).VAL")
#! Record("$(H)ch$(channel):amplification:reset$(S)_",2720,2471,0,1,"$(H)ch$(channel):amplification:reset$(S)_")
#! Field("$(H)ch$(channel):amplification:reset$(SUFFIX)_.DOL",16777215,1,"$(H)ch$(channel):amplification:reset$(SUFFIX)_.DOL")
#! Field("$(H)ch$(channel):amplification:reset$(SUFFIX)_.FLNK",13369395,1,"$(H)ch$(channel):amplification:reset$(SUFFIX)_.FLNK")
#! Link("$(H)ch$(channel):amplification:reset$(SUFFIX)_.FLNK","$(H)ch$(channel):resetAmplification$(SUFFIX)/FLNK")
#! Field("$(H)ch$(channel):amplification:reset$(SUFFIX)_.PROC",13369395,0,"$(H)ch$(channel):amplification:reset$(SUFFIX)_.PROC")
#! Connector("$(H)ch$(channel):resetAmplification$(SUFFIX)/FLNK","$(H)ch$(channel):amplification:check$(S)_",3160,2710,13369395,"",0)
#! Record("$(H)ch$(channel):amplification:set$(S)_",2720,2771,0,1,"$(H)ch$(channel):amplification:set$(S)_")
#! Field("$(H)ch$(channel):amplification:set$(SUFFIX)_.DOL",16777215,1,"$(H)ch$(channel):amplification:set$(SUFFIX)_.DOL")
#! Field("$(H)ch$(channel):amplification:set$(SUFFIX)_.FLNK",13369395,1,"$(H)ch$(channel):amplification:set$(SUFFIX)_.FLNK")
#! Link("$(H)ch$(channel):amplification:set$(SUFFIX)_.FLNK","$(H)ch$(channel):setAmplification$(SUFFIX)/FLNK1")
#! Field("$(H)ch$(channel):amplification:set$(SUFFIX)_.PROC",13369395,0,"$(H)ch$(channel):amplification:set$(SUFFIX)_.PROC")
#! Connector("$(H)ch$(channel):setAmplification$(SUFFIX)/FLNK1","$(H)ch$(channel):setAmplification$(SUFFIX)/FLNK",2940,2785,13369395,"",0)
#! Connector("$(H)ch$(channel):setAmplification$(SUFFIX)/FLNK","$(H)ch$(channel):amplification:check$(S)_",3047,2640,13369395,"",0)
#! Record("$(H)ch$(channel):amplification:check$(S)_",2960,2662,13369395,1,"$(H)ch$(channel):amplification:check$(S)_")
#! Field("$(H)ch$(channel):amplification:check$(SUFFIX)_.INPA",16777215,1,"$(H)ch$(channel):amplification:check$(SUFFIX)_.INPA")
#! Field("$(H)ch$(channel):amplification:check$(SUFFIX)_.INPB",16777215,1,"$(H)ch$(channel):amplification:check$(SUFFIX)_.INPB")
#! Field("$(H)ch$(channel):amplification:check$(SUFFIX)_.INPC",16777215,1,"$(H)ch$(channel):amplification:check$(SUFFIX)_.INPC")
#! Field("$(H)ch$(channel):amplification:check$(SUFFIX)_.INPD",16777215,1,"$(H)ch$(channel):amplification:check$(SUFFIX)_.INPD")
#! Field("$(H)ch$(channel):amplification:check$(SUFFIX)_.INPE",16777215,1,"$(H)ch$(channel):amplification:check$(SUFFIX)_.INPE")
#! Field("$(H)ch$(channel):amplification:check$(SUFFIX)_.INPF",16777215,0,"$(H)ch$(channel):amplification:check$(SUFFIX)_.INPF")
#! Link("$(H)ch$(channel):amplification:check$(SUFFIX)_.INPF","$(H)ch$(channel):amplification$(SUFFIX).VAL")
#! Field("$(H)ch$(channel):amplification:check$(SUFFIX)_.OUT",16777215,0,"$(H)ch$(channel):amplification:check$(SUFFIX)_.OUT")
#! Link("$(H)ch$(channel):amplification:check$(SUFFIX)_.OUT","$(H)ch$(channel):amplificationCheck$(SUFFIX)_/OUT")
#! Connector("$(H)ch$(channel):amplificationCheck$(SUFFIX)_/OUT","$(H)ch$(channel):amplification$(SUFFIX).VAL",2100,2910,16777215,"",0)
#! Record("$(H)ch$(channel):amplification:select$(S)_",2440,2643,13369395,0,"$(H)ch$(channel):amplification:select$(S)_")
#! Field("$(H)ch$(channel):amplification:select$(SUFFIX)_.OUT",13369395,1,"$(H)ch$(channel):amplification:select$(SUFFIX)_.OUT")
#! Link("$(H)ch$(channel):amplification:select$(SUFFIX)_.OUT","$(H)ch$(channel):amplification:reset$(SUFFIX)_.PROC")
#! Field("$(H)ch$(channel):amplification:select$(SUFFIX)_.SIML",16777215,0,"$(H)ch$(channel):amplification:select$(SUFFIX)_.SIML")
#! Link("$(H)ch$(channel):amplification:select$(SUFFIX)_.SIML","$(H)ch$(channel):amplification$(SUFFIX).VAL")
#! Field("$(H)ch$(channel):amplification:select$(SUFFIX)_.SIOL",13369395,1,"$(H)ch$(channel):amplification:select$(SUFFIX)_.SIOL")
#! Link("$(H)ch$(channel):amplification:select$(SUFFIX)_.SIOL","$(H)ch$(channel):amplification:set$(SUFFIX)_.PROC")
